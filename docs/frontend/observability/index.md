# 快速理解「前端的可觀測性」

## **什麼是前端的可觀測性？**

可觀測性（Observability）可以讓我們從外部了解一個系統，能夠在不深入瞭解其內部運作的情況下對系統提出問題。

## 三本柱

- 追蹤（Traces）：Traces 是觀察一個請求或操作的整個生命周期，、可以讓我們了解一個請求的整個過程，包含前端發起 API 請求、後端回應、數據解析和渲染等步驟。每個請求或操作被稱為一個 trace，**而每個 trace 由多個步驟組成，這些步驟被稱為 span。**
    - Trace：**Trace 是一個請求或操作的完整記錄**，從使用者在前端觸發事件開始，直到後端處理完成並返回結果。每個 trace 都有一個唯一的識別碼，稱為 Trace ID。
    - Span：**Span 是 trace 中的每個單步操作**，每個 span 記錄該步驟的起始時間、持續時間及相關的 metadata（如 HTTP 狀態碼等）
    - Parent：**Parent 是用來表示 span 之間的層級關係的概念。**每個 span 可能有一個父 span（Parent Span），表示這個步驟是在另一個更大的操作步驟中發生的。
- 指標（Metrics）：Metric 是在系統運行時所捕捉的測量，主要用來**衡量系統或應用的狀態**。每次進行測量時，稱為一次 metric event，它包含測量值、發生時間以及相關的 metadata。
- 日誌（Logs）：Logs 是帶有時間戳記的**文字紀錄**。

## 監控與可觀測性的差異

**監控：針對已知問題，追蹤具體數據，設定告警門檻以快速處理問題。**

- 主要關注「已知問題」。
- 以圖表或 Dashboard 的方式展示數據。
- 可設定告警門檻，協助快速排查問題。

**可觀測性：面對未知問題，利用詳細數據進行深入分析，找出問題的根本原因。**

- 提供豐富資料來源，包括 traces、metrics、logs 等，從多角度深入分析系統狀況。
- 強調在不預知系統內部運作的情況下，透過上述的數據分析與推理，解答未知問題的根本原因。
- 更適合處理「已知的未知數」，診斷和解析新的或未預料到的問題。

## 前端可觀測性主要要解決的問題

- 跨設備和網路的效能差異：使用者使用不同的設備、瀏覽器和網絡環境，這些因素都會影響應用的行為和效能。
- 使用者行為的追蹤與分析：通過追蹤使用者的點擊、滾動、輸入等行為，能夠深入分析這些行為如何影響整體效能。
- 難以預測的錯誤排查：捕捉詳細的錯誤 Logs、Traces 和事件記錄，可以幫助開發者快速找出錯誤的根本原因。
- 前後端協作的端到端追蹤：可觀測性能夠串起所有從前端發出的請求到後端響應的每個步驟，從而清晰了解整個流程中的延遲和瓶頸。

## 解決方案：**OpenTelemetry**

OpenTelemetry 是一個開源的可觀測性框架，用來生成、收集、管理和匯出遙測數據（如追蹤、指標和日誌），其提供了標準化的方式來收集應用程式效能數據，例如追蹤使用者操作、頁面效能、API 請求等，從而幫助分析和高效解決效能問題。

### **特點**

- 生成與匯出遙測數據：注重於生成和匯出遙測數據，而不負責數據的儲存或視覺化，開發者可以自由選擇使用不同的後端工具來分析這些數據。
- 跨平台與多語言支持：無論使用什麼語言或框架，OpenTelemetry 提供標準的 API 和 SDK，方便開發者在不同應用中進行觀測數據的整合，對前端工程師來說，最重要的是可以與 JavaScript 及常見的前端框架整合。
- 無關供應商：不依賴特定供應商，因此開發者可以選擇多種開源或商業解決方案（如 Jaeger、Prometheus）來儲存和分析數據，避免供應商鎖定。

## **前端適用的解決方案：OpenTelemetry Browser**

OpenTelemetry Browser 是 OpenTelemetry 的 JavaScript SDK，專門用來為 Web 應用進行遙測數據的儀器化（instrumentation），尤其是透過瀏覽器來追蹤應用程式的效能數據和使用者行為。而以下是 OpenTelemetry Browser 的特點：

- 輕量級：前端資源有限，因此 OpenTelemetry Browser 以輕量化為目標，確保對效能的影響最小化。
- 多樣化的數據收集：能夠追蹤使用者的交互作用、API 請求的情況、頁面載入效能等多種指標，並通過標準化的方式將數據傳遞到後端。
- 可擴展性：支持自定義擴展，開發者可以根據具體需求添加更多的追蹤和指標，進一步強化可觀測性。
- 一致性：使用統一的標準，無論在前端還是後端，所有數據的格式和結構保持一致，這使得數據的收集和分析更為高效。